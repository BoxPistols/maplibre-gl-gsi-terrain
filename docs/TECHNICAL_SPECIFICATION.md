# 3D Flight Simulator - æŠ€è¡“ä»•æ§˜æ›¸

## ğŸ“‹ ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
3. [ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è©³ç´°](#ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è©³ç´°)
4. [ãƒ‡ãƒ¼ã‚¿æ§‹é€ ](#ãƒ‡ãƒ¼ã‚¿æ§‹é€ )
5. [APIä»•æ§˜](#apiä»•æ§˜)
6. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä»•æ§˜](#ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä»•æ§˜)
7. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£)
8. [ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§](#ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§)

---

## æ¦‚è¦

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå

**MapLibre GL GSI Terrain - 3D Flight Simulator**

### ãƒãƒ¼ã‚¸ãƒ§ãƒ³

2.2.2

### ç›®çš„

æ—¥æœ¬ã®åœ°ç†é™¢åœ°å½¢ãƒ‡ãƒ¼ã‚¿ï¼ˆGSI DEMï¼‰ã‚’ä½¿ç”¨ã—ãŸã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãª3Dãƒ•ãƒ©ã‚¤ãƒˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã€‚
æ•™è‚²ã€è¦³å…‰ã€ãƒ‰ãƒ­ãƒ¼ãƒ³ç‚¹æ¤œè¨ˆç”»ã®ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã€‚

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ã‚«ãƒ†ã‚´ãƒª           | æŠ€è¡“                    | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ |
| ------------------ | ----------------------- | ---------- |
| åœ°å›³ãƒ©ã‚¤ãƒ–ãƒ©ãƒª     | MapLibre GL JS          | 5.0.0      |
| ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èª | TypeScript              | 5.7.2      |
| ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«       | Vite                    | 3.2.11     |
| ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | Vitest                | 2.1.8      |
| E2Eãƒ†ã‚¹ãƒˆ          | Playwright              | 1.49.1     |
| UIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯   | React (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)      | 18.x       |
| ãƒªãƒ³ã‚¿ãƒ¼           | ESLint                  | 9.32.0     |
| ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼     | Prettier                | 3.6.2      |

---

## ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### å…¨ä½“æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     User Interface                       â”‚
â”‚  (HTML5 + CSS3 + Glassmorphism Design)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Application Layer (TypeScript)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ MapStyle     â”‚ Flight       â”‚ Game               â”‚  â”‚
â”‚  â”‚ Manager      â”‚ Controller   â”‚ Controller         â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ Drone        â”‚ Flight Data  â”‚ UI Event           â”‚  â”‚
â”‚  â”‚ Model        â”‚ Manager      â”‚ Handlers           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           MapLibre GL JS (Rendering Engine)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Vector Tiles â”‚ Raster Tiles â”‚ 3D Terrain         â”‚  â”‚
â”‚  â”‚ Rendering    â”‚ Rendering    â”‚ (WebGL2)           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Data Sources & APIs                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ GSI DEM PNG  â”‚ GSI Photo    â”‚ GSI Map Tiles      â”‚  â”‚
â”‚  â”‚ (Terrain)    â”‚ (Satellite)  â”‚ (Vector)           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹é€ 

#### 1. ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤

- **HTML5**: ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚¢ãƒƒãƒ—
- **CSS3**: Glassmorphismã€Grid Layoutã€Flexbox
- **ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: DOM Event Listeners

#### 2. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤

##### ã‚³ã‚¢ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

- `MapStyleManager`: ãƒãƒƒãƒ—ã‚¹ã‚¿ã‚¤ãƒ«ç®¡ç†
- `FlightController`: ãƒ•ãƒ©ã‚¤ãƒˆåˆ¶å¾¡ã¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
- `DroneModel`: 3Dãƒ‰ãƒ­ãƒ¼ãƒ³ãƒ¢ãƒ‡ãƒ«ã¨ç‰©ç†æ¼”ç®—
- `GameController`: å…¥åŠ›ãƒ‡ãƒã‚¤ã‚¹ç®¡ç†
- `FlightDataManager`: ãƒ‡ãƒ¼ã‚¿IOç®¡ç†

#### 3. ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å±¤

- **MapLibre GL JS**: WebGL2ãƒ™ãƒ¼ã‚¹ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- **Custom Layer API**: ã‚«ã‚¹ã‚¿ãƒ 3Dã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- **Terrain Protocol**: GSI DEMå‡¦ç†

#### 4. ãƒ‡ãƒ¼ã‚¿å±¤

- **åœ°ç†é™¢ã‚¿ã‚¤ãƒ« API**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿å–å¾—
- **ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ä¿å­˜
- **IndexedDB**: (å°†æ¥) å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥

---

## ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è©³ç´°

### 1. MapStyleManager

**ãƒ•ã‚¡ã‚¤ãƒ«**: `example/modules/MapStyleManager.ts`

**è²¬å‹™**: ãƒãƒƒãƒ—ã‚¹ã‚¿ã‚¤ãƒ«ã®ç®¡ç†ã¨åˆ‡ã‚Šæ›¿ãˆ

#### ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

```typescript
private map: Map
private currentStyleId: string
private styles: Map<string, MapStyle>
private terrainSource: any
```

#### ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰

| ãƒ¡ã‚½ãƒƒãƒ‰                | å¼•æ•°                     | æˆ»ã‚Šå€¤ | èª¬æ˜                           |
| ----------------------- | ------------------------ | ------ | ------------------------------ |
| `addStyle`              | `MapStyle`               | void   | æ–°ã—ã„ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¿½åŠ            |
| `switchStyle`           | `styleId: string`        | void   | ã‚¹ã‚¿ã‚¤ãƒ«ã‚’åˆ‡ã‚Šæ›¿ãˆ             |
| `setTerrainExaggeration`| `exaggeration: number`   | void   | åœ°å½¢èª‡å¼µåº¦ã‚’å¤‰æ›´               |
| `createStyleControl`    | -                        | HTMLElement | UIã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’ç”Ÿæˆ      |

#### ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©

```typescript
interface MapStyle {
	id: string // ä¸€æ„è­˜åˆ¥å­
	name: string // è¡¨ç¤ºå
	description: string // èª¬æ˜
	thumbnail?: string // ã‚µãƒ ãƒã‚¤ãƒ«URLï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
	styleUrl?: string // Mapbox Style Spec URL
	styleObject?: any // Style Spec Object
}
```

#### ãƒ—ãƒªã‚»ãƒƒãƒˆã‚¹ã‚¿ã‚¤ãƒ«

1. **satellite** - è¡›æ˜Ÿå†™çœŸ
   - ã‚½ãƒ¼ã‚¹: `https://cyberjapandata.gsi.go.jp/xyz/seamlessphoto/{z}/{x}/{y}.jpg`
   - MaxZoom: 18
2. **standard** - æ¨™æº–åœ°å›³
   - ã‚½ãƒ¼ã‚¹: `https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png`
3. **pale** - æ·¡è‰²åœ°å›³
4. **blank** - ç™½åœ°å›³
5. **dark** - ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰
6. **relief** - åœ°å½¢å›³

### 2. FlightController

**ãƒ•ã‚¡ã‚¤ãƒ«**: `example/modules/FlightController.ts`

**è²¬å‹™**: ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ã®å®Ÿè¡Œã¨ã‚«ãƒ¡ãƒ©åˆ¶å¾¡

#### ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

```typescript
private map: Map
private config: FlightControllerConfig
private flightLog: FlightLogEntry[]
private currentFlightPlan: FlightPlanPhase[]
private flightPlanActive: boolean
private currentFlightPhase: number
```

#### ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰

| ãƒ¡ã‚½ãƒƒãƒ‰           | å¼•æ•°                     | æˆ»ã‚Šå€¤   | èª¬æ˜                     |
| ------------------ | ------------------------ | -------- | ------------------------ |
| `setFlightPlan`    | `FlightPlanData`         | void     | ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ã‚’è¨­å®š     |
| `startFlightPlan`  | -                        | void     | ãƒ•ãƒ©ã‚¤ãƒˆé–‹å§‹             |
| `pauseFlightPlan`  | -                        | void     | ä¸€æ™‚åœæ­¢                 |
| `resumeFlightPlan` | -                        | void     | å†é–‹                     |
| `stopFlightPlan`   | -                        | void     | åœæ­¢                     |
| `flyToSmooth`      | `target, options`        | void     | æ»‘ã‚‰ã‹ãªã‚«ãƒ¡ãƒ©ç§»å‹•       |
| `flyAlongPath`     | `waypoints, options`     | void     | ãƒ‘ã‚¹ã«æ²¿ã£ãŸç§»å‹•         |
| `flyOrbit`         | `center, radius, options`| void     | è»Œé“é£›è¡Œ                 |

#### ã‚¤ãƒ¼ã‚¸ãƒ³ã‚°é–¢æ•°

```typescript
export const easingFunctions = {
	linear: (t: number) => t,
	easeInQuad: (t: number) => t * t,
	easeOutQuad: (t: number) => t * (2 - t),
	easeInOutQuad: (t: number) => (t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t),
	easeInCubic: (t: number) => t * t * t,
	easeOutCubic: (t: number) => --t * t * t + 1,
	easeInOutCubic: (t: number) =>
		t < 0.5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1,
	easeInOutSine: (t: number) => -(Math.cos(Math.PI * t) - 1) / 2,
	easeOutElastic: (t: number) => {
		const c4 = (2 * Math.PI) / 3
		return t === 0 ? 0 : t === 1 ? 1 : Math.pow(2, -10 * t) * Math.sin((t * 10 - 0.75) * c4) + 1
	},
}
```

### 3. DroneModel

**ãƒ•ã‚¡ã‚¤ãƒ«**: `example/modules/DroneModel.ts`

**è²¬å‹™**: 3Dãƒ‰ãƒ­ãƒ¼ãƒ³ãƒ¢ãƒ‡ãƒ«ã¨ç‰©ç†ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

#### ç‰©ç†çŠ¶æ…‹

```typescript
interface DronePhysicsState {
	position: [number, number, number] // [çµŒåº¦, ç·¯åº¦, é«˜åº¦]
	velocity: [number, number, number] // [x, y, z] m/s
	acceleration: [number, number, number] // [x, y, z] m/sÂ²
	rotation: [number, number, number] // [roll, pitch, yaw] åº¦
	angularVelocity: [number, number, number] // è§’é€Ÿåº¦ åº¦/s
}
```

#### ç‰©ç†ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

- **ç©ºæ°—æŠµæŠ—ä¿‚æ•°**: 0.95
- **è³ªé‡**: 1.0kgï¼ˆä»®å®šï¼‰
- **æœ€å¤§é€Ÿåº¦**: 20 m/s
- **æœ€å¤§è§’é€Ÿåº¦**: 180 åº¦/s

#### ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰

| ãƒ¡ã‚½ãƒƒãƒ‰         | å¼•æ•°                        | æˆ»ã‚Šå€¤              | èª¬æ˜             |
| ---------------- | --------------------------- | ------------------- | ---------------- |
| `updatePosition` | `[lon, lat, alt]`           | void                | ä½ç½®æ›´æ–°         |
| `updateRotation` | `[roll, pitch, yaw]`        | void                | å›è»¢æ›´æ–°         |
| `updatePhysics`  | `deltaTime: number`         | void                | ç‰©ç†æ¼”ç®—æ›´æ–°     |
| `applyForce`     | `[fx, fy, fz]`              | void                | åŠ›ã‚’åŠ ãˆã‚‹       |
| `applyTorque`    | `[tx, ty, tz]`              | void                | ãƒˆãƒ«ã‚¯ã‚’åŠ ãˆã‚‹   |
| `getTrail`       | -                           | `[lon, lat, alt][]` | ãƒˆãƒ¬ã‚¤ãƒ«å–å¾—     |
| `toGeoJSON`      | -                           | `GeoJSON.Feature`   | GeoJSONå¤‰æ›      |

### 4. GameController

**ãƒ•ã‚¡ã‚¤ãƒ«**: `example/modules/GameController.ts`

**è²¬å‹™**: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒ»ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰å…¥åŠ›ç®¡ç†

#### ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒãƒƒãƒ”ãƒ³ã‚°

| ã‚­ãƒ¼            | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
| --------------- | ---------- |
| W / â†‘           | å‰é€²       |
| S / â†“           | å¾Œé€€       |
| A / â†           | å·¦ç§»å‹•     |
| D / â†’           | å³ç§»å‹•     |
| Space           | ä¸Šæ˜‡       |
| Shift           | ä¸‹é™       |
| Q               | å·¦å›è»¢     |
| E               | å³å›è»¢     |
| Ctrl            | ã‚¿ãƒ¼ãƒœ     |

#### ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰ãƒãƒƒãƒ”ãƒ³ã‚° (Standard Gamepad)

| å…¥åŠ›            | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
| --------------- | ---------- |
| å·¦ã‚¹ãƒ†ã‚£ãƒƒã‚¯X   | å·¦å³ç§»å‹•   |
| å·¦ã‚¹ãƒ†ã‚£ãƒƒã‚¯Y   | å‰å¾Œç§»å‹•   |
| å³ã‚¹ãƒ†ã‚£ãƒƒã‚¯X   | å›è»¢       |
| R2ãƒˆãƒªã‚¬ãƒ¼      | ä¸Šæ˜‡       |
| L2ãƒˆãƒªã‚¬ãƒ¼      | ã‚¿ãƒ¼ãƒœ     |
| Aãƒœã‚¿ãƒ³         | é›¢é™¸       |
| Bãƒœã‚¿ãƒ³         | ç€é™¸       |

#### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

```typescript
private readonly params = {
	moveSpeed: 0.0001, // çµŒåº¦/ç·¯åº¦ã®ç§»å‹•é€Ÿåº¦
	altitudeSpeed: 2.0, // é«˜åº¦å¤‰åŒ–é€Ÿåº¦ (m/s)
	rotationSpeed: 2.0, // å›è»¢é€Ÿåº¦ (åº¦/s)
	turboMultiplier: 2.0, // ã‚¿ãƒ¼ãƒœæ™‚ã®é€Ÿåº¦å€ç‡
}
```

#### ãƒ‡ãƒƒãƒ‰ã‚¾ãƒ¼ãƒ³å‡¦ç†

- **ãƒ‡ãƒƒãƒ‰ã‚¾ãƒ¼ãƒ³é–¾å€¤**: 0.15
- ã‚¹ãƒ†ã‚£ãƒƒã‚¯å…¥åŠ›ã®çµ¶å¯¾å€¤ãŒ0.15æœªæº€ã®å ´åˆã¯0ã¨ã—ã¦æ‰±ã†

### 5. FlightDataManager

**ãƒ•ã‚¡ã‚¤ãƒ«**: `example/modules/FlightDataManager.ts`

**è²¬å‹™**: ãƒ•ãƒ©ã‚¤ãƒˆãƒ‡ãƒ¼ã‚¿ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ/ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

#### ã‚µãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

| ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ | ã‚¤ãƒ³ãƒãƒ¼ãƒˆ | ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ | èª¬æ˜                   |
| ------------ | ---------- | ------------ | ---------------------- |
| JSON         | âœ…          | âœ…            | ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³æ¨™æº–å½¢å¼ |
| CSV          | âœ…          | âœ…            | è¡¨è¨ˆç®—ã‚½ãƒ•ãƒˆäº’æ›       |
| GPX          | âŒ          | âœ…            | GPSäº¤æ›å½¢å¼            |
| KML          | âŒ          | âœ… (äºˆå®š)    | Google Earthäº’æ›       |

#### ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰

| ãƒ¡ã‚½ãƒƒãƒ‰          | å¼•æ•°               | æˆ»ã‚Šå€¤                    | èª¬æ˜                 |
| ----------------- | ------------------ | ------------------------- | -------------------- |
| `exportToJSON`    | `FlightPlanData`   | void                      | JSONå‡ºåŠ›             |
| `exportToCSV`     | `FlightPlanData`   | void                      | CSVå‡ºåŠ›              |
| `exportToGPX`     | `FlightPlanData`   | void                      | GPXå‡ºåŠ›              |
| `importFromJSON`  | -                  | `Promise<FlightPlanData>` | JSONã‚¤ãƒ³ãƒãƒ¼ãƒˆ       |
| `importFromCSV`   | -                  | `Promise<FlightPlanData>` | CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ        |
| `validateFlightPlan` | `FlightPlanData` | `FlightPlanData`          | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³       |
| `calculateStatistics` | `FlightPlanData` | `Statistics`             | çµ±è¨ˆæƒ…å ±è¨ˆç®—         |

---

## ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

### FlightPlanPhase

```typescript
interface FlightPlanPhase {
	phase: string // ãƒ•ã‚§ãƒ¼ã‚ºå
	action: string // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³èª¬æ˜
	duration: number // ç¶™ç¶šæ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰
	position: [number, number, number] // [çµŒåº¦, ç·¯åº¦, é«˜åº¦(m)]
	pitch?: number // ã‚«ãƒ¡ãƒ©ãƒ”ãƒƒãƒè§’åº¦ï¼ˆ0-85åº¦ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 60ï¼‰
	bearing?: number // ã‚«ãƒ¡ãƒ©æ–¹ä½è§’ï¼ˆ0-360åº¦ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 0ï¼‰
	zoom?: number // ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«ï¼ˆ1-22ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 17ï¼‰
}
```

#### ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«

- `phase`: å¿…é ˆã€éç©ºæ–‡å­—åˆ—
- `action`: å¿…é ˆã€éç©ºæ–‡å­—åˆ—
- `duration`: å¿…é ˆã€æ­£ã®æ•´æ•°
- `position[0]` (çµŒåº¦): -180 ~ 180
- `position[1]` (ç·¯åº¦): -90 ~ 90
- `position[2]` (é«˜åº¦): 0 ~ 10000 (m)
- `pitch`: 0 ~ 85 (åº¦)
- `bearing`: 0 ~ 360 (åº¦)
- `zoom`: 1 ~ 22

### FlightPlanData

```typescript
interface FlightPlanData {
	name: string // ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³å
	description: string // èª¬æ˜
	created: string // ä½œæˆæ—¥æ™‚ï¼ˆISO 8601å½¢å¼ï¼‰
	phases: FlightPlanPhase[] // ãƒ•ã‚§ãƒ¼ã‚ºé…åˆ—
	totalDuration: number // ç·ç¶™ç¶šæ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰
}
```

### FlightLogEntry

```typescript
interface FlightLogEntry {
	timestamp: string // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆHH:MM:SSå½¢å¼ï¼‰
	phase: string // ãƒ•ã‚§ãƒ¼ã‚ºå
	action: string // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
	details: string // è©³ç´°
	type: 'info' | 'success' | 'error' | 'warning' // ãƒ­ã‚°ã‚¿ã‚¤ãƒ—
}
```

### MapStyle

```typescript
interface MapStyle {
	id: string // ä¸€æ„ID
	name: string // è¡¨ç¤ºå
	description: string // èª¬æ˜
	thumbnail?: string // ã‚µãƒ ãƒã‚¤ãƒ«URLï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
	styleUrl?: string // Mapbox Style Spec URL
	styleObject?: any // Style Spec Object
}
```

---

## APIä»•æ§˜

### åœ°ç†é™¢ã‚¿ã‚¤ãƒ« API

#### DEMï¼ˆæ¨™é«˜ï¼‰ã‚¿ã‚¤ãƒ«

```
URL: https://tiles.gsj.jp/tiles/elev/mixed/{z}/{y}/{x}.png
å½¢å¼: PNGï¼ˆRGBï¼‰
ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°: Terrariumå½¢å¼
  - æ¨™é«˜(m) = (R * 256 + G + B / 256) - 32768
æœ€å¤§ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«: 17
ã‚¿ã‚¤ãƒ«ã‚µã‚¤ã‚º: 256x256
```

#### å†™çœŸã‚¿ã‚¤ãƒ«

```
URL: https://cyberjapandata.gsi.go.jp/xyz/seamlessphoto/{z}/{x}/{y}.jpg
å½¢å¼: JPEG
æœ€å¤§ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«: 18
ã‚¿ã‚¤ãƒ«ã‚µã‚¤ã‚º: 256x256
```

#### æ¨™æº–åœ°å›³ã‚¿ã‚¤ãƒ«

```
URL: https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png
å½¢å¼: PNG
æœ€å¤§ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«: 18
ã‚¿ã‚¤ãƒ«ã‚µã‚¤ã‚º: 256x256
```

### ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒˆã‚³ãƒ«

#### gsidem://

GSI DEM PNGã‚¿ã‚¤ãƒ«ã‚’å–å¾—ã—ã€WebGL2ã§Terrariumå½¢å¼ã«å¤‰æ›

```typescript
const protocolAction = getGsiDemProtocolAction('gsidem')
maplibregl.addProtocol('gsidem', protocolAction)

// ä½¿ç”¨ä¾‹
tiles: ['gsidem://https://tiles.gsj.jp/tiles/elev/mixed/{z}/{y}/{x}.png']
```

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä»•æ§˜

### ç›®æ¨™ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

| æŒ‡æ¨™                | ç›®æ¨™å€¤     | æ¸¬å®šæ–¹æ³•              |
| ------------------- | ---------- | --------------------- |
| åˆæœŸãƒ­ãƒ¼ãƒ‰æ™‚é–“      | < 3ç§’      | DOMContentLoaded      |
| ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆ      | 60 FPS     | requestAnimationFrame |
| ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡        | < 500MB    | Chrome DevTools       |
| ã‚¿ã‚¤ãƒ«èª­ã¿è¾¼ã¿æ™‚é–“  | < 1ç§’      | Network Panel         |

### æœ€é©åŒ–æ‰‹æ³•

#### 1. ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æœ€é©åŒ–

- **ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒãƒƒãƒãƒ³ã‚°**: åŒç¨®ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
- **ã‚«ãƒªãƒ³ã‚°**: è¦–ç•Œå¤–ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’éè¡¨ç¤º
- **LOD**: ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸè©³ç´°åº¦èª¿æ•´

#### 2. ãƒ‡ãƒ¼ã‚¿æœ€é©åŒ–

- **ã‚¿ã‚¤ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°**: Service Workerã«ã‚ˆã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- **ãƒ‡ãƒ¼ã‚¿åœ§ç¸®**: GeoJSON â†’ Protocol Buffersï¼ˆæ¤œè¨ä¸­ï¼‰
- **é…å»¶èª­ã¿è¾¼ã¿**: å¿…è¦ãªã‚¿ã‚¤ãƒ«ã®ã¿èª­ã¿è¾¼ã¿

#### 3. ã‚³ãƒ¼ãƒ‰æœ€é©åŒ–

- **Tree Shaking**: æœªä½¿ç”¨ã‚³ãƒ¼ãƒ‰ã®å‰Šé™¤
- **ã‚³ãƒ¼ãƒ‰åˆ†å‰²**: Dynamic import
- **ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå‰Šæ¸›**: < 1MBï¼ˆgzipåœ§ç¸®å¾Œï¼‰

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

#### 1. XSSå¯¾ç­–

- **å…¥åŠ›ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³**: ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
- **Content Security Policy**: CSPãƒ˜ãƒƒãƒ€ãƒ¼è¨­å®š
- **DOMPurify**: HTMLã‚µãƒ‹ã‚¿ã‚¤ã‚ºï¼ˆæ¤œè¨ä¸­ï¼‰

#### 2. CORSå¯¾ç­–

- **åœ°ç†é™¢API**: CORSè¨±å¯æ¸ˆã¿
- **ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«**: File APIä½¿ç”¨

#### 3. ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼

- **ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³**: ã‚¹ã‚­ãƒ¼ãƒãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- **åº§æ¨™ç¯„å›²**: ç¯„å›²ãƒã‚§ãƒƒã‚¯
- **å‹å®‰å…¨æ€§**: TypeScriptå‹ãƒã‚§ãƒƒã‚¯

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [x] XSSè„†å¼±æ€§ãƒã‚§ãƒƒã‚¯
- [x] CSRFå¯¾ç­–ï¼ˆä¸è¦ï¼šå¤–éƒ¨APIå‘¼ã³å‡ºã—ãªã—ï¼‰
- [x] å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- [ ] CSPãƒ˜ãƒƒãƒ€ãƒ¼è¨­å®šï¼ˆæ¤œè¨ä¸­ï¼‰
- [ ] Subresource Integrityï¼ˆæ¤œè¨ä¸­ï¼‰

---

## ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§

### ã‚µãƒãƒ¼ãƒˆãƒ–ãƒ©ã‚¦ã‚¶

| ãƒ–ãƒ©ã‚¦ã‚¶         | æœ€å°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å‹•ä½œç¢ºèªæ¸ˆã¿ |
| ---------------- | -------------- | ------------ |
| Chrome           | 90+            | âœ…            |
| Firefox          | 88+            | âœ…            |
| Safari           | 14+            | âš ï¸ (ä¸€éƒ¨åˆ¶é™) |
| Edge             | 90+            | âœ…            |
| Opera            | 76+            | âœ…            |

### å¿…é ˆæ©Ÿèƒ½

- [x] WebGL2ã‚µãƒãƒ¼ãƒˆ
- [x] ES2020ã‚µãƒãƒ¼ãƒˆ
- [x] Gamepad APIï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- [x] File API
- [x] Blob API
- [x] Canvas API

### ãƒãƒªãƒ•ã‚£ãƒ«

- **requestAnimationFrame**: ä¸è¦ï¼ˆãƒ¢ãƒ€ãƒ³ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚µãƒãƒ¼ãƒˆï¼‰
- **Promise**: ä¸è¦ï¼ˆES6ã§ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚µãƒãƒ¼ãƒˆï¼‰
- **Fetch API**: ä¸è¦ï¼ˆMapLibreå†…éƒ¨ã§ä½¿ç”¨ï¼‰

---

## ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤

### ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰

```bash
# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
pnpm dev

# ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰
pnpm build

# ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ“ãƒ«ãƒ‰
pnpm build:lib

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pnpm test

# E2Eãƒ†ã‚¹ãƒˆ
pnpm test:e2e

# ãƒªãƒ³ã‚¿ãƒ¼å®Ÿè¡Œ
pnpm lint

# ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼å®Ÿè¡Œ
pnpm format
```

### å‡ºåŠ›æ§‹æˆ

```
dist/
â”œâ”€â”€ terrain.js          # ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæœ¬ä½“ï¼ˆUMDï¼‰
â”œâ”€â”€ terrain.d.ts        # TypeScriptå‹å®šç¾©
â””â”€â”€ terrain.js.map      # ã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ—

demo/
â”œâ”€â”€ index.html          # ãƒ‡ãƒ¢HTML
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ index.[hash].js  # ãƒãƒ³ãƒ‰ãƒ«JS
â”‚   â””â”€â”€ index.[hash].css # ãƒãƒ³ãƒ‰ãƒ«CSS
```

### ç’°å¢ƒå¤‰æ•°

```bash
# é–‹ç™ºç’°å¢ƒ
NODE_ENV=development
VITE_API_URL=https://cyberjapandata.gsi.go.jp

# æœ¬ç•ªç’°å¢ƒ
NODE_ENV=production
VITE_API_URL=https://cyberjapandata.gsi.go.jp
```

---

## ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ (Vitest)

- **ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™**: 80%ä»¥ä¸Š
- **å¯¾è±¡**: å…¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
- **å®Ÿè¡Œé »åº¦**: æ¯ã‚³ãƒŸãƒƒãƒˆ

### E2Eãƒ†ã‚¹ãƒˆ (Playwright)

- **å¯¾è±¡ã‚·ãƒŠãƒªã‚ª**:
  1. ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³èª­ã¿è¾¼ã¿
  2. ãƒ•ãƒ©ã‚¤ãƒˆå®Ÿè¡Œ
  3. ãƒãƒƒãƒ—ã‚¹ã‚¿ã‚¤ãƒ«åˆ‡ã‚Šæ›¿ãˆ
  4. æ‰‹å‹•æ“ä½œ
  5. ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

- **Lighthouse**: å®šæœŸå®Ÿè¡Œ
- **WebPageTest**: ãƒªãƒªãƒ¼ã‚¹å‰å®Ÿè¡Œ

---

## ä»Šå¾Œã®æ‹¡å¼µäºˆå®š

### Phase 2

- [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼
- [ ] VR/ARã‚µãƒãƒ¼ãƒˆ
- [ ] æ°—è±¡ãƒ‡ãƒ¼ã‚¿çµ±åˆ
- [ ] AIçµŒè·¯æœ€é©åŒ–

### Phase 3

- [ ] ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªï¼ˆReact Nativeï¼‰
- [ ] ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰
- [ ] ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸ
- [ ] ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£å…±æœ‰æ©Ÿèƒ½

---

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License

## ä½œæˆè€…

BoxPistols

## æ›´æ–°å±¥æ­´

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ—¥ä»˜       | å¤‰æ›´å†…å®¹                               |
| ---------- | ---------- | -------------------------------------- |
| 2.2.2      | 2025-01-15 | 3Dãƒ•ãƒ©ã‚¤ãƒˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼æ©Ÿèƒ½è¿½åŠ        |
| 2.2.1      | 2024-12-01 | åœ°å½¢èª‡å¼µåº¦èª¿æ•´æ©Ÿèƒ½è¿½åŠ                  |
| 2.2.0      | 2024-11-01 | MapLibre GL v5å¯¾å¿œ                     |
| 2.1.0      | 2024-10-01 | Reactå¯¾å¿œ                              |
| 2.0.0      | 2024-09-01 | åˆç‰ˆãƒªãƒªãƒ¼ã‚¹                           |
