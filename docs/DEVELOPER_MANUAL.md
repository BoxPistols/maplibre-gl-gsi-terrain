# ãƒ‰ãƒ­ãƒ¼ãƒ³é£›è¡Œã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ - é–‹ç™ºè€…ãƒãƒ‹ãƒ¥ã‚¢ãƒ«

## ğŸ“‹ ç›®æ¬¡

1. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦)
2. [ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
3. [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ](#ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ )
4. [ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ](#ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ)
5. [ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ã‚·ã‚¹ãƒ†ãƒ ](#ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ã‚·ã‚¹ãƒ†ãƒ )
6. [ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚¬ã‚¤ãƒ‰](#ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚¬ã‚¤ãƒ‰)
7. [ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ](#ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ)
8. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

### ğŸ—ï¸ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: TypeScript + Vite
- **åœ°å›³ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: MapLibre GL JS
- **åœ°å½¢ãƒ‡ãƒ¼ã‚¿**: å›½åœŸåœ°ç†é™¢ DEM (Terrariumå½¢å¼)
- **ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°**: CSS-in-JS (inline styles)
- **ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«**: Vite 5.x
- **å‹ãƒã‚§ãƒƒã‚¯**: TypeScript 5.x

### ğŸ“ ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           User Interface (HTML)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          Application Logic (TS)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Flight   â”‚ Drone    â”‚ Map Style    â”‚    â”‚
â”‚  â”‚Controllerâ”‚ Model    â”‚ Manager      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         MapLibre GL JS (Rendering)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    å›½åœŸåœ°ç†é™¢ DEM / Tile Server              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

```bash
# ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³
git clone <repository-url>
cd maplibre-gl-gsi-terrain

# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•
npm run dev

# ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã
# http://localhost:5173
```

### ğŸ“¦ åˆ©ç”¨å¯èƒ½ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```bash
# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼
npm run dev

# ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰
npm run build

# ãƒ“ãƒ«ãƒ‰ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
npm run preview

# ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
npm run format

# ãƒªãƒ³ãƒˆ
npm run lint
npm run lint:fix

# ãƒ†ã‚¹ãƒˆ
npm run test
npm run test:e2e
```

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
maplibre-gl-gsi-terrain/
â”œâ”€â”€ example/                    # ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ index.html             # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ (HTML)
â”‚   â”œâ”€â”€ index.ts               # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ (TypeScript)
â”‚   â”œâ”€â”€ favicon.svg            # ã‚¢ãƒ—ãƒªã‚¢ã‚¤ã‚³ãƒ³
â”‚   â”œâ”€â”€ modules/               # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”‚   â”œâ”€â”€ FlightController.ts    # ãƒ•ãƒ©ã‚¤ãƒˆåˆ¶å¾¡
â”‚   â”‚   â”œâ”€â”€ DroneModel.ts          # ãƒ‰ãƒ­ãƒ¼ãƒ³ãƒ¢ãƒ‡ãƒ«
â”‚   â”‚   â”œâ”€â”€ MapStyleManager.ts     # åœ°å›³ã‚¹ã‚¿ã‚¤ãƒ«ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ GameController.ts      # ã‚²ãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
â”‚   â”‚   â”œâ”€â”€ TouchController.ts     # ã‚¿ãƒƒãƒæ“ä½œ
â”‚   â”‚   â””â”€â”€ types.ts               # å‹å®šç¾©
â”‚   â””â”€â”€ data/                  # ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ãƒ‡ãƒ¼ã‚¿
â”‚       â”œâ”€â”€ mt-fuji-flight-plan.json
â”‚       â”œâ”€â”€ tokyo-skytree-flight-plan.json
â”‚       â””â”€â”€ kyoto-kinkakuji-flight-plan.json
â”œâ”€â”€ src/                       # ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚½ãƒ¼ã‚¹
â”‚   â”œâ”€â”€ terrain.ts             # åœ°å½¢ãƒ—ãƒ­ãƒˆã‚³ãƒ«
â”‚   â”œâ”€â”€ worker.ts              # Webãƒ¯ãƒ¼ã‚«ãƒ¼
â”‚   â””â”€â”€ data-import-export.ts  # ãƒ‡ãƒ¼ã‚¿å‡¦ç†
â”œâ”€â”€ docs/                      # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ USER_MANUAL.md         # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ‹ãƒ¥ã‚¢ãƒ«
â”‚   â””â”€â”€ DEVELOPER_MANUAL.md    # é–‹ç™ºè€…ãƒãƒ‹ãƒ¥ã‚¢ãƒ«
â””â”€â”€ tests/                     # ãƒ†ã‚¹ãƒˆ
    â””â”€â”€ e2e/                   # E2Eãƒ†ã‚¹ãƒˆ
```

---

## ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### ğŸ® FlightController

ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ã®å®Ÿè¡Œã‚’ç®¡ç†ã™ã‚‹ã‚³ã‚¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€‚

#### ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰

```typescript
class FlightController {
  // ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ã‚’è¨­å®š
  setFlightPlan(plan: FlightPlanData): void

  // ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ã‚’é–‹å§‹
  startFlightPlan(): void

  // ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ã‚’ä¸€æ™‚åœæ­¢
  pauseFlightPlan(): void

  // ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ã‚’å†é–‹
  resumeFlightPlan(): void

  // ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ã‚’åœæ­¢
  stopFlightPlan(): void

  // ãƒ­ã‚°æ›´æ–°ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’è¨­å®š
  setLogUpdateCallback(callback: (log: FlightLogEntry[]) => void): void
}
```

#### ä½¿ç”¨ä¾‹

```typescript
// åˆæœŸåŒ–
const flightController = new FlightController(map)

// ãƒ­ã‚°ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’è¨­å®š
flightController.setLogUpdateCallback(log => {
  updateFlightLogDisplay()
})

// ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ã‚’è¨­å®š
flightController.setFlightPlan({
  name: 'ãƒ†ã‚¹ãƒˆãƒ•ãƒ©ã‚¤ãƒˆ',
  description: 'ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³',
  phases: [/* phases */],
  created: new Date().toISOString(),
  totalDuration: 30000,
})

// å®Ÿè¡Œ
flightController.startFlightPlan()
```

### ğŸ—ºï¸ Waypointå¯è¦–åŒ–ã‚·ã‚¹ãƒ†ãƒ 

#### updateFlightPlanVisualization

ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ã®ã‚¦ã‚§ã‚¤ãƒã‚¤ãƒ³ãƒˆã¨ãƒ‘ã‚¹ã‚’åœ°å›³ä¸Šã«å¯è¦–åŒ–ã—ã¾ã™ã€‚

```typescript
const updateFlightPlanVisualization = (flightPlan: FlightPlanPhase[]) => {
  // å‹å®‰å…¨ãªãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
  const setGeoJsonSourceData = (sourceId: string, features: GeoJSON.Feature[]) => {
    const source = map.getSource(sourceId)
    if (source?.type === 'geojson') {
      (source as maplibregl.GeoJSONSource).setData({
        type: 'FeatureCollection',
        features: features,
      })
    }
  }

  // ã‚¦ã‚§ã‚¤ãƒã‚¤ãƒ³ãƒˆä½œæˆ
  const waypointFeatures = flightPlan.map((phase, index) => ({
    type: 'Feature' as const,
    geometry: {
      type: 'Point' as const,
      coordinates: [phase.position[0], phase.position[1]],
    },
    properties: {
      id: `waypoint-${index}`,
      name: `WP${index + 1}: ${phase.phase}`,
      // ...
    },
  }))

  // ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
  setGeoJsonSourceData('flight-plan-waypoints', waypointFeatures)
  setGeoJsonSourceData('flight-plan-path', [pathFeature])
}
```

### ğŸ“¹ FPVã‚«ãƒ¡ãƒ©ã‚·ã‚¹ãƒ†ãƒ 

ãƒ‰ãƒ­ãƒ¼ãƒ³ã®ç›®ç·šã§ãƒ•ãƒ©ã‚¤ãƒˆã‚’ä½“é¨“ã§ãã‚‹ã‚«ãƒ¡ãƒ©ã‚·ã‚¹ãƒ†ãƒ ã€‚

```typescript
const executeFlightPhase = () => {
  const phase = currentFlightPlan[currentFlightPhase]

  // æ¬¡ã®waypointã¸ã®æ–¹ä½ã‚’è¨ˆç®—
  let bearing = 0
  if (currentFlightPhase < currentFlightPlan.length - 1) {
    const nextPhase = currentFlightPlan[currentFlightPhase + 1]
    bearing = calculateBearing(
      [phase.position[0], phase.position[1]],
      [nextPhase.position[0], nextPhase.position[1]]
    )
  }

  // FPVã‚«ãƒ¡ãƒ©è¨­å®š
  map.flyTo({
    center: [drone.longitude, drone.latitude],
    zoom: phase.zoom ?? 18,
    pitch: phase.pitch ?? 70,  // ãƒ‰ãƒ­ãƒ¼ãƒ³è¦–ç‚¹
    bearing: bearing,           // é€²è¡Œæ–¹å‘
    duration: phase.duration,
  })
}
```

---

## ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ã‚·ã‚¹ãƒ†ãƒ 

### ğŸ“ FlightPlanDataå‹å®šç¾©

```typescript
interface FlightPlanData {
  name: string                  // ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³å
  description: string           // èª¬æ˜
  created: string              // ä½œæˆæ—¥æ™‚ (ISO 8601)
  totalDuration: number        // ç·æ‰€è¦æ™‚é–“ (ms)
  phases: FlightPlanPhase[]    // ãƒ•ã‚§ãƒ¼ã‚ºé…åˆ—
}

interface FlightPlanPhase {
  phase: string                 // ãƒ•ã‚§ãƒ¼ã‚ºå (ä¾‹: "é›¢é™¸", "æ—‹å›1")
  action: string                // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³èª¬æ˜
  duration: number              // æ‰€è¦æ™‚é–“ (ms)
  position: [number, number, number]  // [çµŒåº¦, ç·¯åº¦, é«˜åº¦]
  zoom?: number                 // ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ« (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)
  pitch?: number                // ãƒ”ãƒƒãƒè§’åº¦ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)
  bearing?: number              // æ–¹ä½è§’åº¦ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)
}
```

### ğŸ¯ æ–°ã—ã„ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ã®ä½œæˆ

#### 1. JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ

```json
{
  "name": "æ–°ã—ã„å ´æ‰€ã®ãƒ•ãƒ©ã‚¤ãƒˆ",
  "description": "è©³ç´°ãªèª¬æ˜",
  "created": "2024-01-15T10:00:00Z",
  "totalDuration": 30000,
  "phases": [
    {
      "phase": "é›¢é™¸",
      "action": "é–‹å§‹åœ°ç‚¹ã‹ã‚‰é›¢é™¸",
      "duration": 3000,
      "position": [çµŒåº¦, ç·¯åº¦, é«˜åº¦],
      "zoom": 17,
      "pitch": 60,
      "bearing": 0
    }
    // ... ä»–ã®ãƒ•ã‚§ãƒ¼ã‚º
  ]
}
```

#### 2. ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®

```bash
example/data/my-flight-plan.json
```

#### 3. ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã«è¿½åŠ 

`example/index.ts` ã® `flightPlanSelect` ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’ç·¨é›†:

```typescript
const fileMap: Record<string, string> = {
  'mt-fuji': './data/mt-fuji-flight-plan.json',
  'tokyo-skytree': './data/tokyo-skytree-flight-plan.json',
  'my-plan': './data/my-flight-plan.json',  // è¿½åŠ 
}
```

HTMLã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ :

```html
<select id="flightPlanSelect">
  <option value="tokyo-tower">æ±äº¬ã‚¿ãƒ¯ãƒ¼</option>
  <option value="my-plan">ãƒã‚¤ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³</option>
</select>
```

---

## ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚¬ã‚¤ãƒ‰

### ğŸ¨ ã‚¹ã‚¿ã‚¤ãƒ«ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

#### ã‚¦ã‚§ã‚¤ãƒã‚¤ãƒ³ãƒˆã®è‰²ã‚’å¤‰æ›´

`example/index.html` ã® `setupLayers()` å†…:

```typescript
map.addLayer({
  id: 'flight-plan-waypoints-layer',
  type: 'circle',
  source: 'flight-plan-waypoints',
  paint: {
    'circle-color': '#ff00ff',  // è‰²ã‚’å¤‰æ›´
    'circle-radius': [
      'interpolate', ['linear'], ['zoom'],
      10, 8,   // ã‚µã‚¤ã‚ºã‚’å¤‰æ›´
      18, 16,
    ],
    // ...
  },
})
```

#### ãƒ•ãƒ©ã‚¤ãƒˆãƒ‘ã‚¹ã®ã‚¹ã‚¿ã‚¤ãƒ«

```typescript
map.addLayer({
  id: 'flight-plan-path-layer',
  type: 'line',
  source: 'flight-plan-path',
  paint: {
    'line-color': '#00ff00',     // è‰²ã‚’å¤‰æ›´
    'line-width': 5,             // å¤ªã•ã‚’å¤‰æ›´
    'line-opacity': 0.9,         // é€æ˜åº¦ã‚’å¤‰æ›´
    'line-dasharray': [2, 2],   // ç‚¹ç·šã«ã™ã‚‹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  },
})
```

### ğŸ¯ ã‚«ãƒ¡ãƒ©å‹•ä½œã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

#### ãƒ”ãƒƒãƒè§’åº¦ã®èª¿æ•´

```typescript
// example/index.ts ã® executeFlightPhase() å†…
map.flyTo({
  center: [drone.longitude, drone.latitude],
  zoom: phase.zoom ?? 18,
  pitch: phase.pitch ?? 80,  // ã‚ˆã‚Šæ€¥ãªè§’åº¦ï¼ˆ0-85ã®ç¯„å›²ï¼‰
  bearing: bearing,
  duration: phase.duration,
})
```

#### ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«

```typescript
const phase = currentFlightPlan[currentFlightPhase]

map.flyTo({
  center: [drone.longitude, drone.latitude],
  zoom: phase.zoom ?? 20,  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚ºãƒ¼ãƒ ã‚’å¤‰æ›´
  // ...
})
```

### ğŸ“Š ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

#### ãƒ­ã‚°ã‚¨ãƒ³ãƒˆãƒªã®æœ€å¤§æ•°

```typescript
// example/index.ts ã® addFlightLog() å†…
if (flightLog.length > 100) {  // æœ€å¤§æ•°ã‚’å¤‰æ›´
  flightLog = flightLog.slice(-50)  // ä¿æŒã™ã‚‹æ•°ã‚’å¤‰æ›´
}
```

#### ãƒ­ã‚°ã®è‰²ã¨ã‚¹ã‚¿ã‚¤ãƒ«

`example/index.html` ã® CSS:

```css
.log-entry-latest {
  background: rgba(34, 197, 94, 0.2);  /* èƒŒæ™¯è‰² */
  border-left: 5px solid #22c55e;      /* ãƒœãƒ¼ãƒ€ãƒ¼å¤ªã• */
}

.latest-indicator {
  color: #ff0000;  /* ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼è‰² */
}
```

---

## ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### ğŸŒ Vercelã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# ãƒ“ãƒ«ãƒ‰
npm run build

# Vercel CLIã§ãƒ‡ãƒ—ãƒ­ã‚¤
vercel --prod
```

### ğŸ“¦ é™çš„ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°

```bash
# ãƒ“ãƒ«ãƒ‰
npm run build

# demo/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
# - Netlify
# - GitHub Pages
# - Cloudflare Pages
```

### ğŸ”§ ç’°å¢ƒå¤‰æ•°

å¿…è¦ã«å¿œã˜ã¦ `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ:

```env
VITE_MAP_STYLE_URL=https://your-custom-style.com/style.json
VITE_TERRAIN_URL=https://your-terrain-server.com/tiles
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ğŸ› ã‚ˆãã‚ã‚‹å•é¡Œ

#### ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼

**å•é¡Œ**: `npm run build` ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ

**è§£æ±ºæ–¹æ³•**:
```bash
# node_modulesã‚’å‰Šé™¤ã—ã¦å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
rm -rf node_modules package-lock.json
npm install
npm run build
```

#### å‹ã‚¨ãƒ©ãƒ¼

**å•é¡Œ**: TypeScriptã®å‹ã‚¨ãƒ©ãƒ¼

**è§£æ±ºæ–¹æ³•**:
```bash
# å‹å®šç¾©ã‚’ç¢ºèª
npm run build  # tscãŒè‡ªå‹•å®Ÿè¡Œã•ã‚Œã‚‹

# å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª
cat example/modules/types.ts
```

#### åœ°å›³ãŒè¡¨ç¤ºã•ã‚Œãªã„

**å•é¡Œ**: åœ°å›³ã‚¿ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œãªã„

**è§£æ±ºæ–¹æ³•**:
1. ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª
2. å›½åœŸåœ°ç†é™¢ã®ã‚¿ã‚¤ãƒ«ã‚µãƒ¼ãƒãƒ¼ãŒæ­£å¸¸ã‹ç¢ºèª
3. ãƒ—ãƒ­ãƒˆã‚³ãƒ«è¨­å®šã‚’ç¢ºèª:

```typescript
const protocolAction = getGsiDemProtocolAction('gsidem')
maplibregl.addProtocol('gsidem', protocolAction)
```

### ğŸ” ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯

#### ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã®æœ‰åŠ¹åŒ–

```typescript
// è©³ç´°ãªãƒ­ã‚°ã‚’å‡ºåŠ›
console.log('ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³:', currentFlightPlan)
console.log('ç¾åœ¨ã®ãƒ•ã‚§ãƒ¼ã‚º:', currentFlightPhase)
console.log('ãƒ‰ãƒ­ãƒ¼ãƒ³ä½ç½®:', drone)
```

#### ã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ—

é–‹ç™ºãƒ¢ãƒ¼ãƒ‰ã§ã¯ã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ—ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã¾ã™:

```bash
npm run dev
# ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§å…ƒã®TypeScriptã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªå¯èƒ½
```

---

## API ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

### ä¸»è¦ãªé–¢æ•°

#### updateFlightPlanVisualization

ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ã‚’åœ°å›³ä¸Šã«å¯è¦–åŒ–ã—ã¾ã™ã€‚

```typescript
updateFlightPlanVisualization(flightPlan: FlightPlanPhase[]): void
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `flightPlan`: ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ã®ãƒ•ã‚§ãƒ¼ã‚ºé…åˆ—

**æˆ»ã‚Šå€¤**: ãªã—

#### calculateBearing

2ç‚¹é–“ã®æ–¹ä½è§’ã‚’è¨ˆç®—ã—ã¾ã™ã€‚

```typescript
calculateBearing(
  start: [number, number],
  end: [number, number]
): number
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `start`: é–‹å§‹åº§æ¨™ [çµŒåº¦, ç·¯åº¦]
- `end`: çµ‚äº†åº§æ¨™ [çµŒåº¦, ç·¯åº¦]

**æˆ»ã‚Šå€¤**: æ–¹ä½è§’ï¼ˆ0-360åº¦ï¼‰

#### updateFlightLogDisplay

ãƒ•ãƒ©ã‚¤ãƒˆãƒ­ã‚°ã®è¡¨ç¤ºã‚’æ›´æ–°ã—ã¾ã™ã€‚

```typescript
updateFlightLogDisplay(): void
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**: ãªã—

**æˆ»ã‚Šå€¤**: ãªã—

---

## ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

### ğŸ¤ ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

1. ãƒ•ã‚©ãƒ¼ã‚¯ã‚’ä½œæˆ
2. ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ (`git checkout -b feature/amazing-feature`)
3. å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ (`git commit -m 'Add amazing feature'`)
4. ãƒ–ãƒ©ãƒ³ãƒã‚’ãƒ—ãƒƒã‚·ãƒ¥ (`git push origin feature/amazing-feature`)
5. ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆ

### ğŸ“ ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

- **TypeScript**: å³å¯†ãªå‹ãƒã‚§ãƒƒã‚¯ã‚’ä½¿ç”¨
- **ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**: Prettier (è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ)
- **ãƒªãƒ³ãƒˆ**: ESLint
- **ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: æ˜ç¢ºã§èª¬æ˜çš„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

---

## ğŸ“š å‚è€ƒè³‡æ–™

- [MapLibre GL JS Documentation](https://maplibre.org/maplibre-gl-js-docs/)
- [å›½åœŸåœ°ç†é™¢ åœ°ç†é™¢ã‚¿ã‚¤ãƒ«](https://maps.gsi.go.jp/development/ichiran.html)
- [TypeScript Documentation](https://www.typescriptlang.org/docs/)
- [Vite Documentation](https://vitejs.dev/)

---

**Version**: 2.2.2
**Last Updated**: 2025-01-15

ğŸ’» Happy Coding!
